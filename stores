<div id="pop-over">
    <span class="pull-left">
        <div id="pop-over-map-name">Default Name</div>
        <div id="pop-over-map-phone">Phone Number</div>
    </span>
    <span class="pullright"><img src="https://testbucketblurt.s3-us-west-2.amazonaws.com/sites/54205e6a6a616d39c5860000/04dd4f94364d574f0365c89cbafa12c4/btn_search_arrow.png"></span>
</div>
<div class="container store-list">
    <div class="row">
        <div class="col-xs-12 col-sm-4 col-md-3">
            <div id="">
            <h1 class="sidebar-title" data-i18n="nav.stores"></h1>
            <div class="panel-group" id="accordion">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" id="by_a_z">
                                <span data-i18n="nav.subnav.stores_a-z"></span>
                                <i class="pull-right fa fa-angle-down fa-lg"></i>
                            </a>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in alpha-table">
                        <div class="panel-body store-letters">
                            <a href="#A">A</a>
                            <a href="#B">B</a>
                            <a href="#C">C</a>
                            <a href="#D">D</a>
                            <a href="#E">E</a>
                            <a href="#F">F</a>
                            <a href="#G">G</a>
                            <a href="#H">H</a>
                            <a href="#I">I</a>
                            <a href="#J">J</a>
                            <a href="#K">K</a>
                            <a href="#L">L</a>
                            <a href="#M">M</a>
                            <a href="#N">N</a>
                            <a href="#O">O</a>
                            <a href="#P">P</a>
                            <a href="#Q">Q</a>
                            <a href="#R">R</a>
                            <a href="#S">S</a>
                            <a href="#T">T</a>
                            <a href="#U">U</a>
                            <a href="#V">V</a>
                            <a href="#W">W</a>
                            <a href="#X">X</a>
                            <a href="#Y">Y</a>
                            <a href="#Z">Z</a>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default categories">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" id="by_categories">
                            <span data-i18n="nav.subnav.categories"></span>
                            <i class="pull-right fa fa-angle-down fa-lg"></i>
                        </a>
                      </h4>
                    </div>
                    <div id="collapseTwo" class="panel-collapse collapse">
                        <div class="panel-body store-categories list-group" id="store_categories">
                            <script id="category_item_template" type="x-tmpl-mustache">
                                <a class="list-group-item" href="#cat_{{id}}">{{name}}</a>
                            </script>
                        </div>
                    </div>
                </div>
            </div>          
        </div>
        </div>
        <div class="col-xs-12 col-sm-8 col-md-9" id="right-content">

            <div style="overflow:hidden" class="map-border">
            <div id="zControls">
                <button class="zoom-in"><span class="glyphicon glyphicon-plus"></span></button>
                <button class="zoom-out"><span class="glyphicon glyphicon-minus"></span></button>
                
            </div>
            <div id="map" class="panzoom-elements" style=""></div>
            </div>
            
            <div class="list-group" id="store_list">
                <h2>Loading Store Directory.....</h2>
            </div>
            <div id="no_stores_list" style="display:none">
                <h2 data-i18n="general.no_stores"></h2>
            </div>
            <script id="store_header_template" type="x-tmpl-mustache">
                
                <a class="list-group-item">
                    <a class="anchor" name="{{header_id}}"></a>
                    <h2>{{header}}</h2>
                </a>
            </script>
            <script id="store_item_template" type="x-tmpl-mustache">
                <a class="list-group-item" href="../stores/{{slug}}">
                    <span class="store-name">{{name}}</span>
                    <span class="promotions-flag" style="display:{{has_promotions_css}}">
                        <i class="fa fa-tag fa-lg"></i>
                    </span>
                    <span class="jobs-flag" style="display:{{has_jobs_css}}">
                        <i class="fa fa-suitcase fa-lg"></i>
                    </span>
                    <span class="store-phone pull-right hidden-phone phone-number">{{phone}}</span>
                    <span class="store-phone pull-right">
                        <i class="fa fa-phone fa-lg"></i>
                    </span>
                </a>
            </script>
        </div>
    </div>
</div>

<!--For more information please see http://learnjs.io/blog/2013/11/30/snapsvg-resources/-->
<script src="//cdnjs.cloudflare.com/ajax/libs/snap.svg/0.3.0/snap.svg-min.js"></script>
<script src="https://kodekloud.s3.amazonaws.com/sites/5422419e4a616d74d9030000/e1fb5e17ab727d248230fbcb51da868f/jquery.panzoom.min.js"></script>
        
<script>
    $(document).ready(function() {
        var isMobile = ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) );
        $("#pop-over").hide();
        var didPanZoom = false;
        
        function renderPageData(){
            //renders the store list by referencing the template id and the html id
            //for where to place the rendered content. See mallmaverick.js for implementation
            renderCategoriesListTemplate('#category_item_template','#store_categories',getStoreCategories());
            renderStoresListTemplate('#store_header_template','#store_item_template','#store_list','#store_list','#no_stores_list',getStoresList());
            
            $('#by_a_z').click(function(){
                renderStoresListTemplate('#store_header_template','#store_item_template','#store_list','#store_list','#no_stores_list',getStoresList());
            });
            
            $('#by_categories').click(function(){
                renderStoresByCategoriesListTemplate('#store_header_template','#store_item_template','#store_list','#store_list','#no_stores_list',getStoresList());
            });
            renderSVGMap();
            
            regions = {};
            var stores = getStoresList();
            $.each( stores , function( key, val ) {
                if(val.svgmap_region != null && typeof(val.svgmap_region)  != 'undefined'){
                    obj = {};
                    obj["tooltip"] = "<div class='tooltip_div'><span class='pull-left'><div class='tooltip_name'>" + val.name + "</div><div class='tooltip_phone'>" + val.phone + "</div></span><span class='pullright'><img class='tooltip_img' src='https://testbucketblurt.s3-us-west-2.amazonaws.com/sites/54205e6a6a616d39c5860000/04dd4f94364d574f0365c89cbafa12c4/btn_search_arrow.png'></span></div>"
                    obj["attr"] = {}
                    obj["attr"]["href"] = "/stores/"+val.slug
                    regions[val.svgmap_region] = obj
                }
            });
            load_map(regions, store_details);
            
            //$(document).i18n();
            
        }
        
        loadMallDataCached(renderPageData);
        
        function goToStore(store_details){
            if(typeof(store_details) != 'undefined' && store_details != null){
                window.location.href = "/stores/"+store_details.slug;
            }
        }
        
        function load_map(reg, store_details){
            this_region = {};
            this_region = store_details.svgmap_region;
            map = $('#mapsvg_store_detail').mapSvg({
                source: getSVGMapURL(),    // Path to SVG map
                colors: {stroke: '#000', hover: '#66FFFF', selected: '#66FFFF', background: '#fff'},
                disableAll: true,
                height: 450,
                width: 690,
                regions: reg,
                tooltipsMode: 'custom',
                loadingText: "loading...",
                zoom: true,
                zoomButtons: {'show': true,'location': 'left' },
                pan: true,
                cursor:'move',
                responsive: true,
                zoomLimit: [0, 3],
                viewBox:[598, -468, 1987.199, 1548]
            });
            map.setViewBox();
            map.selectRegion(store_details.svgmap_region);
        }
        
        // function renderSVGMap(){
        //     if(navigator.appVersion.indexOf("MSIE 9.") == -1){
                
        //         $('#map').bind('mousemove', function(e){
        //             //console.log(e.pageX+","+e.pageY);
        //           $('#pop-over').css({'top':e.pageY+20,'left':e.pageX-70});
        //         });
                
        //         var s = Snap("#map");
        //         //var stores = [{'svg_id':'#goldsgym','store_id':'14336'},{'svg_id':'#_x38_0','store_id':'14342'},{'svg_id':'#_x37_7','store_id':'14386'},{'svg_id':'#_x31_05','store_id':'14334'},{'svg_id':'#_x31_62','store_id':'14344'},{'svg_id':'#_x31_61','store_id':'14345'} ];
        //         var stores = getStoresList();
        //         Snap.load(getSVGMapURL(), function (f) {
        //             $.each( stores, function( key, value ) {
        //                 if(value.svgmap_region != null && typeof(value.svgmap_region)  != 'undefined'){
        //                     var svg_id = "#" + value.svgmap_region;
        //                     if(f.select(svg_id) != null){
        //                         console.log(f.select(svg_id) == null)
        //                         f.select(svg_id).mouseover(function() {
        //                             if(typeof(value) != 'undefined' && value != null){
        //                                 this.addClass("map-mouse-over");
        //                                 $("#pop-over").show();
        //                                 $("#pop-over-map-name").html(value.name);
        //                                 $("#pop-over-map-phone").html(value.phone);
        //                             }
                                          
        //                         });
                            
                            
                                
        //                         f.select(svg_id).mouseout(function() {
        //                             this.removeClass("map-mouse-over");
        //                             $("#pop-over").hide(0);
                                    
        //                         });
                                
        //                         f.select(svg_id).mouseup(function() {
                                    
        //                             if(!isMobile && !didPanZoom){
                                        
        //                                 goToStore(value);
        //                             }
        //                             didPanZoom = false;
                                          
        //                         });
        //                     }
        //                 }
        //             });
                   
        //             s.append(f.select("svg"));
                    
        //         });
                
                
        //         var startingMapTransform = 'scale(0.35)';
        //         var startingPanX = -250;
        //         var startingPanY = -200;
        //         if(isMobile) {
        //                 startingMapTransform = 'scale(0.20)';
        //                 startingPanX = -170;
        //                 startingPanY = -200;
        //         }
        //         $('#loading').hide();
        //         $( "#page_content" ).fadeIn( "fast", function() {
        //             var panzoom = $(".panzoom-elements").panzoom({
        //                 cursor: "move",
        //                 increment: 0.1,
        //                 minScale: 0.15,
        //                 maxScale: 1,
        //                 transition: true,
        //                 duration: 150,
        //                 easing: "ease-in-out",
        //                 $zoomIn: $('.zoom-in'),
        //                 $zoomOut: $('.zoom-out'),
        //                 $zoomRange: $('.zoom-range'),
        //                 startTransform: startingMapTransform
            
        //             });
        //             $(".panzoom-elements").panzoom("pan", startingPanX, startingPanY, { relative: true });
                    
        //             panzoom.on('panzoomchange', function(e, panzoom, matrix, changed) {
        //               didPanZoom = true;
        //             });
                    
        //             panzoom.on('panzoomend', function(e, panzoom, matrix, changed) {
        //               didPanZoom = false;
        //             });
        //         });
        //     }else{
        //         $('#loading').hide();
        //         $('#zControls').hide();
        //         $('#map').hide();
        //         $( "#page_content" ).fadeIn( "fast");
        //     }
        // }
        
    });

    
</script>






	
	